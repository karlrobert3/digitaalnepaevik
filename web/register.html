<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="Register.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
<div id="app">
    <div class="counainer-fluid">
        <div class="row">
            <div class="col-8 offset-2">
                <div class="alert alert-success" role="alert" v-if="isSuccessful">
                    Check your E-mail
                </div>
                <div class="alert alert-danger" role="alert" v-if="!isDataValid" v-if="!isSuccessful">
                    <ul>
                        <li v-if="!firstNameLength">
                            First name must contain at least one uppercase and one lowercase letter
                        </li>
                        <li v-if="!lastNameLength">
                            Last name must contain at least one uppercase and one lowercase letter
                        </li>
                        <li v-if="!emailLength">
                            E-mail must contain "@nrg.edu.ee" or "@opilased.nrg.edu.ee"
                        </li>
                        <li v-if="!roomNuberLenght">
                            Room number must contain exactly three numbers
                        </li>
                        <li v-if="!isPasswordValid">
                            Passwords must contain at least eight characters,
                            including uppercase,
                            lowercase letters and
                            numbers.
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row" v-if="!isSuccessful">
            <div class="col-8 offset-2">
                <div class="card mt-5">
                    <div class="card-header">
                        Register
                    </div>
                    <div class="card-body">
                        <div class="row p-3">
                            <div class="col">
                                <label>First name</label>
                            </div>
                            <div class="col">
                                <input v-model="dataToSend.firstname"
                                       type="text"
                                       class="form-control"
                                       name="firstname"
                                       placeholder="First name"
                                       @onblur="firstNameLength"
                                       required
                                       :class="{'is-invalid': !firstNameLength}">
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="col">
                                <label>Last name</label>
                            </div>
                            <div class="col">
                                <input v-model="dataToSend.lastname"
                                       type="text"
                                       class="form-control"
                                       name="lastname"
                                       placeholder="Last name"
                                       required
                                       :class="{'is-invalid': !lastNameLength}">
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="col">
                                <label>E-mail</label>
                            </div>
                            <div class="col">
                                <input v-model="dataToSend.email"
                                       type="email"
                                       class="form-control"
                                       name="email"
                                       placeholder="email"
                                       aria-describedby="emailHelp"
                                       required :class="{'is-invalid': !emailLength}">
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="col">
                                <label>Room number</label>
                            </div>
                            <div class="col">
                                <input v-model="dataToSend.room_number"
                                       type="text"
                                       class="form-control"
                                       name="roomNuber"
                                       placeholder="Room number"
                                       required :class="{'is-invalid': !roomNuberLenght}">
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="col">
                                <label>Password</label>
                            </div>
                            <div class="col">
                                <input v-model="dataToSend.password"
                                       type="password"
                                       class="form-control"
                                       name="password"
                                       placeholder="Password"
                                       required :class="{'is-invalid': !isPasswordValid}">
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="col">
                                <label>Retype password</label>
                            </div>
                            <div class="col">
                                <input v-model="password2"
                                       type="password"
                                       class="form-control"
                                       name="password2"
                                       placeholder="Retype Password"
                                       required :class="{'is-invalid': !isPasswordValid}">
                            </div>
                        </div>
                        <div class="row p-4 text-right">
                            <div class="col">
                                <button class="btn btn-primary" @click="sendData" type="button" name="signup-button">
                                    Sign up
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-right">
                        <a href="login.html">Sign in</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!--<div class="login-box" id="app">
    <div class="register">
        <h1> Sign Up</h1>
        <form name="valid">
            <div class="form-row">
                <div class="firstname">
                    <label>First name</label>
                    <input v-model="dataToSend.firstname" type="text" class="form-control" name="firstname"
                           placeholder="First name" required :class="{'is-invalid': !firstNameLength}">
                </div>
                <div class="lastname">
                    <label for="validationDefault02">Last name</label>
                    <input v-model="dataToSend.lastname" type="text" class="form-control" id="validationDefault02"
                           name="lastname" placeholder="Last name" required :class="{'is-invalid': !lastNameLength}">
                </div>
                <div class="email">
                    <label for="validationDefault03">email</label>
                    <input v-model="dataToSend.email" type="email" class="form-control" id="validationDefault03"
                           name="email" placeholder="email" aria-describedby="emailHelp" required
                           :class="{'is-invalid': !emailLength}">
                </div>
                <div class="password">
                    <label for="validationDefault04">Password</label>
                    <input v-model="dataToSend.password" type="password" class="form-control" id="validationDefault04"
                           name="password" placeholder="Password" required :class="{'is-invalid': !isPasswordValid}">
                </div>
                <div class="retype password">
                    <label for="validationDefault05">Retype password</label>
                    <input v-model="password2" type="password" class="form-control" id="validationDefault05"
                           name="password2" placeholder="Retype Password" required
                           :class="{'is-invalid': !isPasswordValid}">
                </div>
            </div>
            <button class="btn btn-primary" @click="sendData" type="button" name="signup-button">Sign up</button>
        </form>
        <a href="login.html">Log in</a>-->
<!-- <input v-model="dataToSend.firstname" type="text" name="firstname" placeholder="Firstname"/>
<input v-model="dataToSend.lastname" type="text" name="lastname" placeholder="Lastname"/>
<input v-model="dataToSend.email" type="text" name="email" placeholder="Email"/>
<input v-model="dataToSend.password" type="password" name="password" placeholder="Password"/>
<input v-model="password2" type="password" name="password2" placeholder="Retype password"/>
<input  type="button" class="esitaBtn" @click="sendData" name="signup-button" value="Sign Up"/>-->


</div>

</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
<script>
  const app = new Vue({
    el: '#app',
    data: {
      password2: null,
      dataToSend: {
        firstname: '',
        lastname: '',
        email: '',
        password: '',
        room_number: '',
      },
      result: ''
    },
    computed: {
      items: function () {
        return this.result
      },
      firstNameLength: function () {
        if (this.dataToSend.firstname.match(/[a-zA-Z]/g)) {
          return this.dataToSend.firstname.length > 1
        } else {
          return false
        }
      },
      lastNameLength: function () {
        if (this.dataToSend.lastname.match(/[a-zA-Z]/g)) {
          return this.dataToSend.lastname.length > 1
        } else {
          return false
        }
      },
      emailLength: function () {
        //if (this.dataToSend.email.match(/@nrg.edu.ee/)|| this.dataToSend.email.match(/@opilased.nrg.edu.ee/)) {
        return this.dataToSend.email.length > 1
        //} else {
        //return false

      },

      isPasswordValid: function () {
        //todo kõik üheks
        if (this.dataToSend.password.match(/[a-z]/g) && this.dataToSend.password.match(
          /[A-Z]/g) && this.dataToSend.password.match(
          /[0-9]/g) && this.dataToSend.password.length >= 8) {
          return this.dataToSend.password === this.password2
        } else {
          return false;


        }
      },
      roomNuberLenght: function () {
        return this.dataToSend.room_number.length === 3
      },
      isDataValid: function () {
        return ![this.firstNameLength, this.lastNameLength, this.isPasswordValid, this.emailLength, this.roomNuberLenght].some(i => !i)
      },
      isSuccessful: function () {
        console.log(this.result)
        return this.result === 'Succes'
      },
    },
    mounted() {
      console.log(this.isSuccessful)
    },

    methods: {
      sendData: function () {
        if (this.isDataValid) {
          axios.post('/api/registration', this.dataToSend)
            .then((result) => {
              console.log(result)
              this.$set(this, 'result', result.data)

            })
            .catch(error => {
              console.log('We have an error', Object.keys(error));
              console.log('We have an error', error.response);
              if (error.response.status === 403) {
                alert(error.response.data)
              }
              if (error.response.status=== 400) {
                alert(error.response.data)
              }
            })
        }

      },
    }

  })
</script>
</html>